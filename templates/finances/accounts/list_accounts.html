{% extends 'base.html' %}
{% load static %}
{% load money_format %}


{% block title %}Lista de Contas - Sistema Financeiro{% endblock %}

{% block extra_css %}
<style>
    .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), #1e40af);
        color: white;
        border: none;
        padding: 0.5rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
        height: 38px;
        display: flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        min-width: 120px;
    }
    
    .btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }
    
    .btn-primary:hover::before {
        left: 100%;
    }
    
    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(43, 108, 176, 0.4);
        color: white;
        text-decoration: none;
    }
    
    .btn-primary:active {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(43, 108, 176, 0.3);
    }
    
    .page-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        color: white;
        box-shadow: var(--card-shadow);
    }
    
    .page-header h1 {
        margin: 0;
        font-size: 2.5rem;
        font-weight: 700;
    }
    
    .page-header .subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 0;
    }
    
    .content-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .search-box {
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .search-box .form-control {
        padding-left: 40px;
        height: 38px;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        transition: all 0.2s ease;
    }
    
    .search-box .form-control:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.2rem rgba(43, 108, 176, 0.25);
    }
    
    .search-box i {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
        z-index: 2;
    }
    
    .form-select {
        height: 38px;
        border: 1px solid #dee2e6;
        border-radius: 6px;
    }
    
    .accounts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }
    
    .account-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 2rem;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
        border-left: 4px solid var(--accent-color);
    }
    
    .account-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 40px rgba(0,0,0,0.12);
    }
    
    .account-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .account-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        margin: 0;
    }
    
    .account-type {
        background: rgba(43, 108, 176, 0.1);
        color: var(--accent-color);
        padding: 0.25rem 0.75rem;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .account-info {
        margin-bottom: 1rem;
    }
    
    .account-info p {
        margin: 0.25rem 0;
        color: var(--text-muted);
        font-size: 0.9rem;
    }
    
    .account-balance {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
    }
    
    .balance-positive {
        color: var(--success-color);
    }
    
    .balance-negative {
        color: var(--danger-color);
    }
    
    .balance-zero {
        color: var(--text-muted);
    }
    
    .account-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
        flex-wrap: wrap;
    }
    
    .btn-action {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.2s ease;
        border: 1px solid transparent;
    }
    
    .btn-view {
        background: rgba(43, 108, 176, 0.1);
        color: var(--accent-color);
        border-color: var(--accent-color);
    }
    
    .btn-view:hover {
        background: var(--accent-color);
        color: white;
    }
    
    .btn-info {
        background: rgba(14, 165, 233, 0.1);
        color: #0ea5e9;
        border-color: #0ea5e9;
    }
    
    .btn-info:hover {
        background: #0ea5e9;
        color: white;
    }
    
    .btn-edit {
        background: rgba(214, 158, 46, 0.1);
        color: var(--warning-color);
        border-color: var(--warning-color);
    }
    
    .btn-edit:hover {
        background: var(--warning-color);
        color: white;
    }
    
    .btn-delete {
        background: rgba(229, 62, 62, 0.1);
        color: var(--danger-color);
        border-color: var(--danger-color);
    }
    
    .btn-delete:hover {
        background: var(--danger-color);
        color: white;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 2rem;
        margin-bottom: 2.5rem;
    }
    
    .stat-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 2rem;
        text-align: center;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        color: var(--text-muted);
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: var(--card-shadow);
    }
    
    .empty-state i {
        font-size: 4rem;
        color: var(--text-muted);
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    .empty-state h3 {
        color: var(--primary-color);
        margin-bottom: 1rem;
        font-weight: 700;
    }
    
    .empty-state p {
        color: var(--text-muted);
        margin-bottom: 2rem;
    }
    
    .breadcrumb {
        background: transparent;
        padding: 1rem 0;
        margin-bottom: 0;
    }

    .breadcrumb-item a {
        color: var(--accent-color);
        text-decoration: none;
        font-weight: 500;
    }

    .breadcrumb-item a:hover {
        color: var(--primary-color);
    }

    .breadcrumb-item.active {
        color: var(--text-muted);
    }
    
    @media (max-width: 768px) {
        .container-fluid {
            padding: 0.5rem;
        }
        
        .page-header {
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .page-header h1 {
            font-size: 1.8rem;
            text-align: center;
        }
        
        .page-header .subtitle {
            font-size: 1rem;
            text-align: center;
        }
        
        .accounts-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card {
            padding: 1rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
        }
        
        .content-card {
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .row.align-items-center > div {
            margin-bottom: 0.5rem;
        }
        
        @media (min-width: 768px) {
            .row.align-items-center > div {
                margin-bottom: 0;
            }
        }
        
        .btn-primary {
            width: 100%;
            justify-content: center;
        }
        
        .account-card {
            padding: 1.5rem;
        }
        
        .account-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.5rem;
        }
        
        .account-name {
            font-size: 1.1rem;
        }
        
        .account-info p {
            font-size: 0.85rem;
        }
        
        .account-balance {
            font-size: 1.3rem;
            text-align: center;
            margin: 1rem 0;
        }
        
        .account-actions {
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        .btn-action {
            flex: 1;
            min-width: 60px;
            text-align: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .empty-state {
            padding: 2rem 1rem;
        }
        
        .empty-state i {
            font-size: 3rem;
        }
        
        .empty-state h3 {
            font-size: 1.3rem;
        }
        
        .breadcrumb {
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }
    }
    
    @media (max-width: 480px) {
        .page-header h1 {
            font-size: 1.5rem;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .stat-card {
            padding: 0.8rem;
        }
        
        .stat-value {
            font-size: 1.3rem;
        }
        
        .account-card {
            padding: 1rem;
        }
        
        .account-balance {
            font-size: 1.2rem;
        }
        
        .btn-action {
            font-size: 0.75rem;
            padding: 0.5rem 0.6rem;
        }
        
        .search-box input {
            font-size: 0.9rem;
        }
        
        .form-select {
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="page-header">
        <h1><i class="fas fa-university me-3"></i>Lista de Contas</h1>
        <p class="subtitle">Gerencie todas as contas do sistema financeiro</p>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ total_accounts|default:"0" }}</div>
            <div class="stat-label">Total de Contas</div>
        </div>
        <div class="stat-card">
            <div class="stat-value"><span class="currency-symbol">R$</span> {{ total_balance|money_format }}</div>
            <div class="stat-label">Saldo Total</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ active_accounts|default:"0" }}</div>
            <div class="stat-label">Contas Ativas</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ banks_count|default:"0" }}</div>
            <div class="stat-label">Bancos</div>
        </div>
    </div>

    <!-- Content Card -->
    <div class="content-card">
        <div class="row mb-3">
            <div class="col-12 col-md-3 mb-2 mb-md-0">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" class="form-control" placeholder="Buscar contas..." id="searchInput">
                </div>
            </div>
            <div class="col-12 col-md-2 mb-2 mb-md-0">
                <select class="form-select" id="typeFilter">
                    <option value="">Todos os tipos</option>
                    <option value="corrente">Conta Corrente</option>
                    <option value="poupanca">Conta Poupança</option>
                    <option value="investimento">Conta de Investimento</option>
                    <option value="caixa">Caixa Interno / Dinheiro em Mãos</option>
                </select>
            </div>
            <div class="col-12 col-md-4">
                <a href="{% url 'create_account_view' %}" class="btn btn-primary w-100">
                    <i class="fas fa-plus me-2"></i>Nova Conta
                </a>
            </div>
        </div>

        <!-- Accounts Grid -->
        {% if accounts %}
            <div class="accounts-grid" id="accountsGrid">
                {% for account in accounts %}
                <div class="account-card" data-name="{{ account.name|lower }}" data-bank="{{ account.bank|lower }}" data-type="{{ account.account_type|lower }}">
                    <div class="account-header">
                        <h5 class="account-name">{{ account.name }}</h5>
                        <span class="account-type">{{ account.get_account_type_display }}</span>
                    </div>
                    
                    <div class="account-info">
                        <p><i class="fas fa-building me-2"></i>{{ account.get_bank_display }}</p>
                        <p><i class="fas fa-code-branch me-2"></i>Agência: {{ account.agency }}</p>
                        <p><i class="fas fa-hashtag me-2"></i>Conta: {{ account.account_number }}</p>
                        {% if account.pix_key %}
                        <p><i class="fas fa-qrcode me-2"></i>PIX: {{ account.pix_key }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="account-balance {% if account.current_balance > 0 %}balance-positive{% elif account.current_balance < 0 %}balance-negative{% else %}balance-zero{% endif %}"><span class="currency-symbol">R$</span> {{ account.current_balance|money_format }}</div>
                    
                    <div class="account-actions">
                        <a href="{% url 'detail_account_view' pk=account.pk %}" class="btn-action btn-view">
                            <i class="fas fa-eye me-1"></i>Ver
                        </a>
                        <a href="{% url 'update_accounts_view' pk=account.pk %}" class="btn-action btn-edit">
                            <i class="fas fa-edit me-1"></i>Editar
                        </a>
                        <a href="{% url 'delete_account_view' pk=account.pk %}" class="btn-action btn-delete">
                            <i class="fas fa-trash me-1"></i>Excluir
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- Empty State -->
             <div class="empty-state">
                 <i class="fas fa-university"></i>
                 <h3>Nenhuma conta cadastrada</h3>
                 <p>Comece criando sua primeira conta bancária para gerenciar as finanças da empresa.</p>
                 <a href="{% url 'create_account_view' %}" class="btn btn-primary">
                     <i class="fas fa-plus me-2"></i>Criar Primeira Conta
                 </a>
             </div>
        {% endif %}
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Exclusão</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir a conta <strong id="accountName"></strong>?</p>
                <p class="text-danger"><small>Esta ação não pode ser desfeita.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Excluir</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Currency selector functionality
        const currencySelector = document.getElementById('currencySelector');
        
        if (currencySelector) {
            currencySelector.addEventListener('change', function() {
                const selectedCurrency = this.value;
                const currencySymbols = {
                    'BRL': 'R$',
                    'USD': '$',
                    'EUR': '€'
                };
                
                const newSymbol = currencySymbols[selectedCurrency];
                const currencyElements = document.querySelectorAll('.currency-symbol');
                
                currencyElements.forEach(element => {
                    element.textContent = newSymbol;
                });
            });
        }
        
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                filterAccounts();
            });
        }
        
        // Type filter functionality
        const typeFilter = document.getElementById('typeFilter');
        if (typeFilter) {
            typeFilter.addEventListener('change', function() {
                filterAccounts();
            });
        }
        
        // Combined filter function
        function filterAccounts() {
            const searchInput = document.getElementById('searchInput');
            const typeFilter = document.getElementById('typeFilter');
            
            if (!searchInput || !typeFilter) return;
            
            const searchTerm = searchInput.value.toLowerCase();
            const selectedType = typeFilter.value.toLowerCase();
            const accountCards = document.querySelectorAll('.account-card');
            
            accountCards.forEach(card => {
                const name = card.dataset.name;
                const bank = card.dataset.bank;
                const type = card.dataset.type;
                
                const matchesSearch = name.includes(searchTerm) || bank.includes(searchTerm);
                const matchesType = selectedType === '' || type === selectedType;
                
                if (matchesSearch && matchesType) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Delete confirmation
        window.confirmDelete = function(accountName, accountId) {
            const accountNameElement = document.getElementById('accountName');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const deleteModal = document.getElementById('deleteModal');
            
            if (accountNameElement) {
                accountNameElement.textContent = accountName;
            }
            
            if (confirmDeleteBtn) {
                confirmDeleteBtn.onclick = function() {
                    // Here you would typically submit a form or make an AJAX request
                    console.log('Deleting account:', accountId);
                    // For now, just close the modal
                    if (deleteModal && bootstrap.Modal) {
                        bootstrap.Modal.getInstance(deleteModal).hide();
                    }
                };
            }
            
            if (deleteModal && bootstrap.Modal) {
                new bootstrap.Modal(deleteModal).show();
            }
        };
        
        // Add some animation on page load
        const cards = document.querySelectorAll('.account-card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'all 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
</script>
{% endblock %}